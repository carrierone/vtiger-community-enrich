var profileurl=localStorage.getItem("url");var currentUrl=window.location.href;var iframeStyling="width:420px; \n					height:calc(100% - 51px); \n					position:fixed;\n					right:-420px;\n					top:51px;\n					z-index:100000;\n					box-shadow: rgb(72, 72, 72) 8px 18px 30px 1px;\n					border: 1px solid rgba(0,0,0,.15);";function injectIframe(){var a=document.createElement("iframe");a.setAttribute("style",iframeStyling);a.setAttribute("frameborder","0");a.setAttribute("id","vtIframe");a.setAttribute("src",chrome.runtime.getURL("templates/main.html"));document.body.appendChild(a)}function refreshIframe(){chrome.storage.local.set({reload:1});extractContactInfoValues().then(function(a){chrome.storage.local.set({contactInfo:a},function(){chrome.storage.local.set({reload:0});$("#vtIframe",window.parent.document).attr("src",$("#vtIframe",window.parent.document).attr("src"))})})}function registerIframeOpenEvent(){jQuery("#openIframe").on("click",function(){if($("#vtIframe").css("right")=="0px"){$("#vtIframe").stop().animate({right:"-420px"},200).css({"z-index":"100000"})}else{refreshIframe();$("#vtIframe").stop().animate({right:"0px"},200).css({"z-index":"100000"})}})}if(typeof($)!="undefined"&&typeof extractContactInfoValues!="undefined"){if(profileurl!=currentUrl){localStorage.setItem("url",window.location.href);if(jQuery("#vtIframe").length==0){injectIframe();setTimeout(function(){injectIcon();registerIframeOpenEvent()},3000)}else{chrome.storage.local.set({contactInfo:""},function(){});chrome.storage.local.set({matchedRecords:""},function(){});if(jQuery("#openIframe").length==0){setTimeout(function(){injectIcon();registerIframeOpenEvent()},3000)}}setTimeout(function(){refreshIframe()},1000)}else{if(jQuery("#vtIframe").length==0){injectIframe();setTimeout(function(){injectIcon();registerIframeOpenEvent();setTimeout(function(){refreshIframe()},1000)},3000)}}}chrome.storage.onChanged.addListener(function(c,b){for(var a in c){if(a=="matchedRecords"){var e=c[a];var d=e.newValue;if(d&&d.length==0){jQuery("#matchedRecordsCount").css("opacity",0)}else{if(d&&d.length){jQuery("#matchedRecordsCount").css("opacity",1);jQuery("#matchedRecordsCount").text(d.length)}}}}});document.onselectionchange=function(){chrome.storage.local.set({highlightedText:window.getSelection().toString()},function(){})};